<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('User Dashboard', ~{::main})}">
<head>
    <title>User Dashboard</title>
</head>
<body>
<main th:fragment="main">
    <!-- Page Header -->
    <div class="d-flex align-items-center mb-4">
        <i class="bi bi-person-circle fs-1 text-primary me-3"></i>
        <div>
            <h2 class="mb-1">User Dashboard</h2>
            <p class="text-muted mb-0">Manage your profile and sector preferences</p>
        </div>
    </div>

    <div class="row g-4">
        <!-- User Info Card -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-person-fill me-2"></i>
                        Profile Information
                    </h5>
                    <p class="text-muted small mb-0">Your current account details</p>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-person-fill text-muted me-3"></i>
                                <div>
                                    <p class="text-muted small mb-0">Name</p>
                                    <p class="fw-medium mb-0"
                                       th:text="${currentUser.person.firstName + ' ' + currentUser.person.lastName}">
                                        User Name</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-envelope-fill text-muted me-3"></i>
                                <div>
                                    <p class="text-muted small mb-0">Username</p>
                                    <p class="fw-medium mb-0" th:text="${currentUser.username}">username</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-envelope-fill text-muted me-3"></i>
                                <div>
                                    <p class="text-muted small mb-0">Email</p>
                                    <p class="fw-medium mb-0" th:text="${currentUser.email}">user@example.com</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-building text-muted me-3"></i>
                                <div>
                                    <p class="text-muted small mb-0">Selected Sectors</p>
                                    <p class="fw-medium mb-0">
                                            <span th:if="${currentSubmission != null and currentSubmission.selectedSectors != null and !currentSubmission.selectedSectors.isempty}"
                                                  th:text="${#lists.size(currentSubmission.selectedSectors)} + ' sectors selected'">
                                                5 sectors selected
                                            </span>
                                        <span th:if="${currentSubmission == null or currentSubmission.selectedSectors == null or currentSubmission.selectedSectors.isempty}">
                                                No sectors selected
                                            </span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-check-circle-fill text-muted me-3"></i>
                                <div>
                                    <p class="text-muted small mb-0">Terms Agreement</p>
                                    <p class="fw-medium mb-0">
                                        <span th:if="${currentSubmission != null and currentSubmission.agreeToTerms}"
                                              class="text-success">Accepted</span>
                                        <span th:if="${currentSubmission == null or !currentSubmission.agreeToTerms}"
                                              class="text-warning">Not accepted</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Form Card -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Edit Profile</h5>
                    <p class="text-muted small mb-0">Update your information and sector preferences</p>
                </div>
                <div class="card-body">
                    <!-- Success Message -->
                    <div th:if="${successMessage}" class="alert alert-success" role="alert">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <span th:text="${successMessage}">Success message</span>
                    </div>

                    <!-- Error Message -->
                    <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <span th:text="${errorMessage}">Error message</span>
                    </div>

                    <form th:action="@{/user/update}" method="post" th:object="${userForm}">
                        <div class="mb-3">
                            <label for="firstName" class="form-label">First Name *</label>
                            <input type="text" class="form-control" id="firstName" th:field="*{firstName}"
                                   placeholder="Enter your first name" required>
                            <div th:if="${#fields.hasErrors('firstName')}" class="text-danger small"
                                 th:errors="*{firstName}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="lastName" class="form-label">Last Name *</label>
                            <input type="text" class="form-control" id="lastName" th:field="*{lastName}"
                                   placeholder="Enter your last name" required>
                            <div th:if="${#fields.hasErrors('lastName')}" class="text-danger small"
                                 th:errors="*{lastName}"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Sectors * (Select at least one)</label>
                            <div class="sector-hierarchy">
                                <div th:each="sector : ${sectors}" th:if="${sector.parent == null}" class="sector-item">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox"
                                               th:id="${'sector_' + sector.id}"
                                               th:field="*{selectedSectors}"
                                               th:value="${sector.id}">
                                        <label class="form-check-label fw-medium" th:for="${'sector_' + sector.id}"
                                               th:text="${sector.name}">
                                            Manufacturing
                                        </label>
                                    </div>

                                    <!-- Sub-sectors -->
                                    <div class="sector-sub" th:each="subSector : ${sectors}"
                                         th:if="${subSector.parent == sector.id}">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox"
                                                   th:id="${'sector_' + subSector.id}"
                                                   th:field="*{selectedSectors}"
                                                   th:value="${subSector.id}">
                                            <label class="form-check-label" th:for="${'sector_' + subSector.id}"
                                                   th:text="${subSector.name}">
                                                Sub Sector
                                            </label>
                                        </div>

                                        <!-- Sub-sub-sectors -->
                                        <div class="sector-subsub" th:each="subSubSector : ${sectors}"
                                             th:if="${subSubSector.parent == subSector.id}">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                       th:id="${'sector_' + subSubSector.id}"
                                                       th:field="*{selectedSectors}"
                                                       th:value="${subSubSector.id}">
                                                <label class="form-check-label text-muted"
                                                       th:for="${'sector_' + subSubSector.id}"
                                                       th:text="${subSubSector.name}">
                                                    Sub Sub Sector
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div th:if="${#fields.hasErrors('selectedSectors')}" class="text-danger small"
                                 th:errors="*{selectedSectors}"></div>
                        </div>

                        <hr>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="agreeToTerms" th:field="*{agreeToTerms}"
                                   required>
                            <label class="form-check-label" for="agreeToTerms">
                                I agree to the terms and conditions *
                            </label>
                            <div th:if="${#fields.hasErrors('agreeToTerms')}" class="text-danger small"
                                 th:errors="*{agreeToTerms}"></div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Current Selections -->
    <div th:if="${currentSubmission != null and currentSubmission.selectedSectors != null and !currentSubmission.selectedSectors.empty}"
         class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Selected Sectors</h5>
                    <p class="text-muted small mb-0">Your current sector selections</p>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2">
                            <span th:each="sector : ${currentSubmission.selectedSectors}"
                                  class="badge bg-primary rounded-pill"
                                  th:text="${sector.name}">
                                Sector Name
                            </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>